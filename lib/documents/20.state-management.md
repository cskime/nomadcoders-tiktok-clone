# State Management

## Router migration

- Web에서 주소가 달라져야 하는 부분은 `go_router` package 사용 (v2)
  - `GoRouter` 아래 `GoRoute`에서 이동할 screen 정의
  - `BuildContext`에 추가된 `push`, `pop`을 사용해서 화면 전환
- URL을 바꾸지 않고 route만 이동할 때는 `Navigator` 사용 (v1)
- 예시
  - `MainNavigationScreen` -> `VideoRecordingScreen` : `go_router` 사용
    - URL이 `/home`에서 `/upload`로 바뀌는 것
  - `VideoRecordingScreen` -> `VideoPreviewScreen` : `Navigator` 사용
    - URL은 `/upload`로 변경되지 않고 preview screen으로 이동하는 것

## GoRoute

- URL parameter에 들어올 수 있는 값 제한
  - `/:tab(a|b|c|d)` : 네 개의 값들만 매칭될 수 있음
  - `/e`는 매칭되지 않음
- URL parameter에 들어갈 값을 `BuildContext.pushNamed`에서 `params`에 `Map<String, String>` 값으로 전달할 수도 있다.
  - Web browser에서는 URL로부터 파싱할 수 있음
  - 코드에서 URL parameter에 값을 전달하며 route로 이동할 때는 `params` 사용

## InheritedWidget

- Widget tree에서 위치에 상관 없이 하위 widget들이 바로 접근할 수 있는 widget
- 사용 방법
  - `InheritedWidget`을 상속받는 widget 구현
  - Widget tree 상위에 `InheritedWidget` 추가
  - `InheritedWidget`에 접근하려는 하위 widget에서 `BuildContext.dependOnInheritedWidgetOfExactType<T>` method를 사용해서 `InheritedWidget` 참조
    - Widget tree의 조상 widget들 중 찾으려는 `InheritedWidget`이 없다면 `null` 반환
- `dependOnInheritedWidgetOfExactType<T>`이란 이름은 너무 길기 때문에 일반적으로 `of()` static method를 만들어서 사용하는 편

### updateShouldNotify

- Widget을 rebuild 할지 결정
- `InheritedWidget`을 rebuild할 때 호출됨
- `oldWidget`을 사용해서 이 `InheritedWidget`을 참조하는 하위 widget들도 rebuild 해야할지 결정할 수 있다.

### `InheritedWidget`의 data 갱신 (with `StatefulWidget`)

- `InheritedWidget`은 data에 접근할 수만 있고 data를 변경하고 갱신하는 기능은 없음
- `InheritedWidget`은 data와 data를 변경할 수 있는 방법을 제공할 뿐. 실제 data를 갖고 data를 변경하는 책임은 `StatefulWidget`이 갖는다.
- 변경하려는 값을 '상태'로 보고 `StatefulWidget`을 함께 사용한다.
- 방법
  1. `InheritedWidget`을 `build()`에서 반환하는 `StatefulWidget`을 만든다.
  2. `InheritedWidget`이 갖고 있던 property 및 method를 `StatefulWidget`으로 옮긴다. (상태로 관리)
  3. `StatefulWidget`에서 선언한 property 및 method 참조를 `InheritedWidget`에 주입한다.
  4. Widget tree에서 `InheritedWidget` 대신 `StatefulWidget`을 사용한다.
- Child widget은 이전과 같이 `dependsOnInheritedWidgetOfExactType`으로 `InheritedWidget`에 접근해서 data를 사용한다.
- Child widget에서 `InheritedWidget`에 전달된 data를 변경하는 method를 호출하면, 이 method가 정의된 `StatefulWidget`에서 data state를 변경하고 `setState()`를 호출해서 하위 widget들을 rebuild 하여 widget을 갱신한다.
