# Push Notifications

- 모든 사용자 또는 특정 사용자에게 푸시 알림 보내기
- iOS는 Xcode 설정 및 key 설정 등 필요
- Android는 `firebase_messaging` package만 설치하면 쉽게 사용 가능

## Token을 받아서 database에 저장

- 모든 user(device)가 가진 token을 사용해서 특정 user에게 알림을 보낼 수 있다.
- User database에 token을 저장해서 알림을 보낼 때 사용
- Code
  1. Token 얻기
     ```dart
     final String? token = await FirebaseMessaging.instance.getToken();
     if (token == null) {
         return;
     }
     ```
  2. User database에 저장
     ```dart
     final user = ref.read(authRepo).user;
     await FirebaseFirestore.instance
         .collection("users")
         .doc(user!.uid)
         .update({"token": token})
     ```
  3. Token이 갱신될 때 database에도 갱신
     ```dart
     FirebaseMessaging.instance.onTokenRefresh.listen(
         // 2번 코드 실행
         (newToken) => updateToken(newToken),
     );
     ```
  4. 앱 실행 시 token 초기화
     ```dart
     class MyApp extends ConsumerWidget {
         const MyApp({super.key})
         @override
         Widget build(BuildContext context, WidgetRef ref) {
             // NotificationsProvider에서 1~3번 코드 실행
             ref.watch(notificationsProvider);
             return ...;
         }
     }
     ```
