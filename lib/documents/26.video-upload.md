# Video upload

- Firestore에 새 document 추가
- Storage에 video file 저장

## Firebase Cloud Functions

- Google backend server에 실행시킬 코드를 배포할 수 있는 기능
- 인증, database, storage 등에 변화가 발생했을 때(observing) custom code를 실행시킬 수 있음
- 사용 예시
  - 새로운 user가 sign up 할 때 기본 profile image를 설정하는 custom code 실행
  - 새로운 video가 upload 되면 아래 작업을 수행하는 custom code 실행
    1. Background에서 video 다운로드
    2. 다운로드 받은 video에서 thumbnail 추출
    3. Storage bucket에 thumbnail file 업로드
    4. Upload된 영상에 thumbnail property 추가
  - Firestore에서 video document가 제거되면 storage에서 관련 file을 삭제하는 custom code 실행

## Upload video

1. Video file을 storage에 저장
   - path : `/videos/:uid/:video_name`
   - 사용자 별로 upload한 video 분류
2. Video가 성공적으로 upload 되었다면 Firestore document에도 추가
   - `FirebaseStorage`를 사용해서 `putFile`로 file을 upload하면 `UploadTask`를 얻음
   - `UploadTask.metadata`가 `null`이 아니면 upload에 성공한 것
